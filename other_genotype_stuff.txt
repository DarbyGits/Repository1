### other genotypes assembly! ~/M_euph/jan_2018_seq

##  /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/

#  interleave reads - APSE lines

source khmerEnv/bin/activate

/pub28/markw/bin/khmer/khmerEnv/bin/interleave-reads.py /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_1/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_1/*R2_001.fastq.gz > 16_38_int.fq

/pub28/markw/bin/khmer/khmerEnv/bin/interleave-reads.py /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_4/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_4/*R2_001.fastq.gz > 16_88_int.fq

/pub28/markw/bin/khmer/khmerEnv/bin/interleave-reads.py /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_5/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_5/*R2_001.fastq.gz > 16_98_int.fq

/pub28/markw/bin/khmer/khmerEnv/bin/interleave-reads.py /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_7/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_7/*R2_001.fastq.gz > 17_01_int.fq

/pub28/markw/bin/khmer/khmerEnv/bin/interleave-reads.py /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_8/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_8/*R2_001.fastq.gz > 17_23_int.fq

/pub28/markw/bin/khmer/khmerEnv/bin/interleave-reads.py /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_9/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_9/*R2_001.fastq.gz > 17_31_int.fq

/pub28/markw/bin/khmer/khmerEnv/bin/interleave-reads.py /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_10/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_10/*R2_001.fastq.gz > 17_33_int.fq


#  run discovar de novo on all - Providing with a high amount of cpus should run through them all rather quick(ish)

for file in *.fq ; do 
	fastq=$file
	name=${fastq%_int.*}
	DiscovarDeNovo READS=$file NUM_THREADS=60 MAX_MEM_GB=800 MEMORY_CHECK=True OUT_DIR=discovar_$name 
done


###

# discovar assembly to try to get a solid h. def assembly, use three sets of reads

DiscovarDeNovo READS=17_01_2_int.fq,17_23_2_int.fq,17_33_int.fq NUM_THREADS=90 MAX_MEM_GB=800 MEMORY_CHECK=True OUT_DIR=discovar_01_23_33

bwa075a index a.lines.fasta

cat ../../../17_01_2_int.fq ../../../17_23_2_int.fq ../../../17_33_int.fq > all.fq

bwa075a mem -t 30 ../a.lines.fasta -p all.fq > all.sam


cp /pub28/markw/M_euph/R_res/taxdb.* .

blastn \
-task megablast \
-query a.lines.fasta \
-db /pub28/markw/db/ntdatabase/nt \
-outfmt '6 qseqid staxids bitscore std sscinames sskingdoms stitle' \
-culling_limit 5 \
-num_threads 30 \
-evalue 1e-25 \
-out all_gen2.megablast.out


source ~/virtualenvs/blobtools/bin/activate

/pub28/markw/bin/blobtools/blobtools/blobtools map2cov -i ../a.lines.fasta -s all.sam -o all_gen2_map2cov

mkdir blob_01_23_33
cd blob_01_23_33

/pub28/markw/bin/blobtools/blobtools/blobtools create \
-i ../a.lines.fasta \
-c ../bwa/all.sam.cov \
-t ../all_gen2.megablast.out \
-o blob_01_23_33 \
--names /pub28/markw/bin/blobtools/names.dmp \
--nodes /pub28/markw/bin/blobtools/nodes.dmp

mkdir blobplot_01_23_33

/pub28/markw/bin/blobtools/blobtools/blobtools blobplot \
  -i blob_01_23_33.blobDB.json \
  -o blobplot_01_23_33/
   





###  blast-ing

makeblastdb -in a.lines.fasta -dbtype nucl -parse_seqids    

blastall -p blastn -i /pub28/markw/M_euph/apse_fastas/apse_1.fasta -d a.lines.fasta -a 40 -e 1e-10 -o apse1.blastn

/pub28/markw/M_euph/AK13_30/13_30_apse/contig_50.fa

##  again only some match to toxin unit here
blastall -p tblastn -i /pub28/markw/M_euph/apse_fastas/apse_4_prots.fasta -d a.lines.fasta -a 40 -e 1e-10 -o apse4.tblastn

blastall -p tblastn -i /pub28/markw/M_euph/apse_fastas/apse_2_prots.fasta -d a.lines.fasta -a 40 -e 1e-10 -o apse2.tblastn

blastall -p tblastn -i /pub28/markw/M_euph/apse_fastas/apse_3_prots.fasta -d a.lines.fasta -a 40 -e 1e-10 -o apse3.tblastn

blastall -p tblastn -i /pub28/markw/M_euph/apse_fastas/apse_1_prots.fasta -d a.lines.fasta -a 40 -e 1e-10 -o apse1.tblastn

# 17_01 is circular and approx 35000 in size - could be the whole apse fragment here? flattened line 18

###  apse - matches

# stx - 38, 88, 98(?), 17_01, 17_23, 17_33

# YD - 

# ctd - 

### 17_31 is undeterminable with blast :( - but seems rather similar when viewing mapping with IGV

### 98-- flattened line 0 and flattened line 10 - need to do a bit more digging as to what apse 98 belongs to.
## looks very different to the APSE belonging to 'green' genotypes

awk 'BEGIN{RS=">"}/flattened_line_0/{print">"$o}' a.lines.fasta > 16_98_apse1.fa

awk 'BEGIN{RS=">"}/flattened_line_10/{print">"$o}' a.lines.fasta > 16_98_apse_fl10.fa

head -n 994 16_98_apse_fl10.fa > 16_98_apse_fl10_.fa    # then remove old file
  
  
  
  
  sp|Q9T1T9.1|VP09_BPAPS RecName: Full=Putative protein p9              262   3e-86
AAF03952.1 P9 [Hamiltonella virus APSE1]                              262   3e-86
NP_050970.1 putative cell wall hydrolase [Hamiltonella virus APSE1]   262   3e-86

# use the 17_01 apse strain for mapping - appears to be the most contiguous and is circular??

awk 'BEGIN{RS=">"}/flattened_line_18 circular/{print">"$o}' a.lines.fasta > 17_01_apse.fa

bwa075a index 17_01_apse.fa

bwa075a mem -t 120 -R '@RG\tID:16_38\tSM:gen_2\tPL:illumina\tLB:lib1\tPU:unit1' 17_01_apse.fa -p ../jan_2018_seq/16_38_2_int.fq > 16_38_apse.sam

chos 7

samtools view -Sb 16_38_apse.sam > 16_38_apse.bam

samtools view -h -F 4 16_38_apse.bam > mapped_16_38_apse.bam
 
 
bwa075a mem -t 120 -R '@RG\tID:16_88\tSM:gen_3\tPL:illumina\tLB:lib1\tPU:unit1' 17_01_apse.fa -p ../jan_2018_seq/16_88_3_int.fq > 16_88_apse.sam

chos 7

samtools view -Sb 16_88_apse.sam > 16_88_apse.bam

samtools view -h -F 4 16_88_apse.bam > mapped_16_88_apse.bam


bwa075a mem -t 120 -R '@RG\tID:17_31\tSM:gen_6\tPL:illumina\tLB:lib1\tPU:unit1' 17_01_apse.fa -p ../jan_2018_seq/17_31_6_int.fq > 17_31_apse.sam

chos 7

samtools view -Sb 17_31_apse.sam > 17_31_apse.bam

samtools sort -@ 32 -m 4G 17_31_apse.bam sort_17_31_apse

samtools index sort_17_31_apse.bam


bwa075a mem -t 120 -R '@RG\tID:16_98\tSM:gen_pink\tPL:illumina\tLB:lib1\tPU:unit1' 17_01_apse.fa -p ../jan_2018_seq/16_98_pink_int.fq > 16_98_apse.sam

chos 7

samtools view -Sb 16_98_apse.sam > 16_98_apse.bam

samtools sort -@ 32 -m 4G 16_98_apse.bam sort_16_98_apse

samtools index sort_16_98_apse.bam


bwa075a mem -t 120 -R '@RG\tID:17_33\tSM:gen_2\tPL:illumina\tLB:lib1\tPU:unit1' 17_01_apse.fa -p ../jan_2018_seq/17_33_int.fq > 17_33_apse.sam

chos 7

samtools view -Sb 17_33_apse.sam > 17_33_apse.bam

samtools sort -@ 32 -m 4G 17_33_apse.bam sort_17_33_apse

samtools index sort_17_33_apse.bam


bwa075a mem -t 120 -R '@RG\tID:15_10\tSM:gen_1\tPL:illumina\tLB:lib1\tPU:unit1' 17_01_apse.fa -p /pub28/markw/M_euph/RB15_10/RB15_10.fq > 15_10_apse.sam

chos 7

samtools view -Sb 15_10_apse.sam > 15_10_apse.bam

samtools sort -@ 32 -m 4G 15_10_apse.bam sort_15_10_apse

samtools index sort_15_10_apse.bam



###  apse2 alns

#   /pub28/markw/M_euph/17_01_apse_alns/apse2_alns

bwa075a index apse_2.fasta

bwa075a mem -t 60 -R '@RG\tID:16_38\tSM:gen_2\tPL:illumina\tLB:lib1\tPU:unit1' apse_2.fasta -p ../../jan_2018_seq/16_38_2_int.fq > 16_38_apse2.sam

chos 7

samtools view -Sb 16_38_apse2.sam > 16_38_apse2.bam

samtools sort -@ 16 -m 4G 16_38_apse2.bam sort_16_38_apse2

samtools index sort_16_38_apse2.bam
 
exit

bwa075a mem -t 60 -R '@RG\tID:16_88\tSM:gen_3\tPL:illumina\tLB:lib1\tPU:unit1' apse_2.fasta -p ../../jan_2018_seq/16_88_3_int.fq > 16_88_apse2.sam

chos 7

samtools view -Sb 16_88_apse2.sam > 16_88_apse2.bam

samtools sort -@ 16 -m 4G 16_88_apse2.bam sort_16_88_apse2

exit

bwa075a mem -t 60 -R '@RG\tID:17_31\tSM:gen_6\tPL:illumina\tLB:lib1\tPU:unit1' apse_2.fasta -p ../../jan_2018_seq/17_31_6_int.fq > 17_31_apse2.sam

chos 7

samtools view -Sb 17_31_apse2.sam > 17_31_apse2.bam

samtools sort -@ 16 -m 4G 17_31_apse2.bam sort_17_31_apse2

samtools index sort_17_31_apse2.bam

exit

bwa075a mem -t 60 -R '@RG\tID:16_98\tSM:gen_pink\tPL:illumina\tLB:lib1\tPU:unit1' apse_2.fasta -p ../../jan_2018_seq/16_98_pink_int.fq > 16_98_apse2.sam

chos 7

samtools view -Sb 16_98_apse2.sam > 16_98_apse2.bam

samtools sort -@ 16 -m 4G 16_98_apse2.bam sort_16_98_apse2

samtools index sort_16_98_apse2.bam

exit


bwa075a mem -t 60 -R '@RG\tID:15_10\tSM:gen_1\tPL:illumina\tLB:lib1\tPU:unit1' apse_2.fasta -p /pub28/markw/M_euph/RB15_10/RB15_10.fq > 15_10_apse2.sam

chos 7

samtools view -Sb 15_10_apse2.sam > 15_10_apse2.bam

samtools sort -@ 32 -m 4G 15_10_apse2.bam sort_15_10_apse2

samtools index sort_15_10_apse2.bam





for file in /pub28/markw/M_euph/jan_2018_seq/*.fq ; do 
	fastq=$file
	name=${fastq%_int.*}
	genotype1=${fastq%_int.*}
	genotype2=`echo $genotype1 | sed 's/.._.._//g' `

	bwa075a mem -t 120 -R '@RG\tID:'$name'\tSM:gen_$genotype2\tPL:illumina\tLB:lib1\tPU:unit1' 17_01_apse.fa -p $file > $name_apse.sam
	
done
	
	samtools view -Sb $name_apse.sam > $name_apse.bam

	samtools view -h -F 4 $name_apse.bam > mapped_$name_apse.bam
 
done

fastq=88_88_2_int.fq
name=${fastq%_*_int.*}
genotype1=${fastq%_int.*}
genotype2=`echo $genotype1 | sed 's/.._.._//g' `


bwa075a mem -t 100 -R '@RG\tID:09_03\tSM:gen1\tPL:illumina\tLB:lib1\tPU:unit1' ../split_fasta/ref_gen2.fa



### gatk gen 2 on gen 1 - see gen 2 commands too.....

# /pub28/markw/scaff10x/arcs_4_canu/links_canu_ME.scaffolds.fa

# /pub28/markw/M_euph/MW16_48/gatk

cp /pub28/markw/scaff10x/arcs_4_canu/links_canu_ME.scaffolds.fa .

awk '/^>/{print ">Contig_" ++i; next}{print}' links_canu_ME.scaffolds.fa > ref_gen1.fa

rm links_canu_ME.scaffolds.fa

bwa075a index ref_gen1.fa

# map 16_48 + vcfs

bwa075a mem -t 100 -R '@RG\tID:group1\tSM:16_48\tPL:illumina\tLB:lib1\tPU:unit1' ref_gen1.fa /data/illum/171031_D00213_0226_AHYGM5BCXY/Project_MWhitehead_14766_m1/Sample_3-3_MW_aph/3-3_MW_aph_CGCTCATT-CCTATCCT_L002_R1_001.fastq.gz /data/illum/171031_D00213_0226_AHYGM5BCXY/Project_MWhitehead_14766_m1/Sample_3-3_MW_aph/3-3_MW_aph_CGCTCATT-CCTATCCT_L002_R2_001.fastq.gz > 16_48_bwa.sam

chos 7 

samtools view -Sb 16_48_bwa.sam > 16_48_bwa.bam

samtools view -q 10 -b 16_48_bwa.bam > 16_48_bwa_uniq.bam

samtools sort -@ 16 -m 4G 16_48_bwa_uniq.bam 16_48_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=16_48_bwa_uniq_sort.bam OUTPUT=dedup_16_48.bam METRICS_FILE=metrics.txt

java -jar /pub28/markw/bin/picard/picard-2.8.2.jar CreateSequenceDictionary R=ref_gen1.fa O=ref_gen1.dict

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ref_gen1.fa -I dedup_16_48.bam -o 16_48.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ref_gen1.fa -targetIntervals 16_48.intervals -I dedup_16_48.bam -o re-aln_16_48.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ref_gen1.fa -I re-aln_16_48.bam -stand_call_conf 30 -nct 128 -o 16_48.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 16_48.raw.vcf > filtered_16_48.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ref_gen1.fa -I re-aln_16_48.bam -knownSites filtered_16_48.vcf -nct 64 -o recal_16_48.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ref_gen1.fa -I re-aln_16_48.bam -BQSR recal_16_48.table -nct 128 -o recal_16_48.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ref_gen1.fa -I recal_16_48.bam -stand_call_conf 30 -nct 128 -o 16_48.recal.vcf 


#  map 13_30 + vcfs  -  need to rm 13_30_bwa.sam

bwa075a mem -t 100 -R '@RG\tID:group1\tSM:13_30\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171031_D00213_0226_AHYGM5BCXY/Project_MWhitehead_14766_m1/Sample_4-4_MW_aph/4-4_MW_aph_GAGATTCC-GGCTCTGA_L002_R1_001.fastq.gz /data/illum/171031_D00213_0226_AHYGM5BCXY/Project_MWhitehead_14766_m1/Sample_4-4_MW_aph/4-4_MW_aph_GAGATTCC-GGCTCTGA_L002_R2_001.fastq.gz > 13_30_bwa.sam

chos 7 

samtools view -Sb 13_30_bwa.sam > 13_30_bwa.bam

samtools view -q 10 -b 13_30_bwa.bam > 13_30_bwa_uniq.bam

samtools sort -@ 16 -m 4G 13_30_bwa_uniq.bam 13_30_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=13_30_bwa_uniq_sort.bam OUTPUT=dedup_13_30.bam METRICS_FILE=metrics.txt

samtools index dedup_13_30.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_13_30.bam -o 13_30.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 13_30.intervals -I dedup_13_30.bam -o re-aln_13_30.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_13_30.bam -stand_call_conf 30 -nct 128 -o 13_30.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 13_30.raw.vcf > filtered_13_30.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_13_30.bam -knownSites filtered_13_30.vcf -nct 128 -o recal_13_30.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_13_30.bam -BQSR recal_13_30.table -nct 128 -o recal_13_30.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_13_30.bam -stand_call_conf 30 -nct 128 -o 13_30.recal.vcf 


bgzip -c 13_30.recal.vcf > 13_30.recal.vcf.gz
tabix -p vcf 13_30.recal.vcf.gz

bgzip -c 16_48.recal.vcf > 16_48.recal.vcf.gz
tabix -p vcf 16_48.recal.vcf.gz

vcf-compare 16_48.recal.vcf.gz 13_30_gatk/13_30.recal.vcf.gz > gen2_vcf.comp  # didnt really show much!

vcf-isec -n +2 -f 16_48.recal.vcf.gz 13_30_gatk/13_30.recal.vcf.gz | bgzip -c > out.vcf.gz 


bgzip -c 13_27.recal.vcf > 13_27.recal.vcf.gz
tabix -p vcf 13_27.recal.vcf.gz

tabix -p vcf out.vcf.gz 

vcf-isec -n +2 -f 13_27.recal.vcf.gz out.vcf.gz | bgzip -c > gen1_2.vcf.gz

vcf-isec -c -f out.vcf.gz 13_27.recal.vcf.gz | bgzip -c > uniq_gen2.vcf.gz ##   keeps snps found in both files

zcat uniq_gen2.vcf.gz | grep -v '#'  | wc -l
#  = 1368109



#  map 13_27 + vcfs  - need to rm .sam file

bwa075a mem -t 100 -R '@RG\tID:group1\tSM:13_27\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/161208_K00210_0044_AHFYVTBBXX/Project_MWhitehead_11879_m1/Sample_5/5_TCCGGAGA-CTTCGCCT_L007_R1_001.fastq.gz /data/illum/161208_K00210_0044_AHFYVTBBXX/Project_MWhitehead_11879_m1/Sample_5/5_TCCGGAGA-CTTCGCCT_L007_R2_001.fastq.gz > 13_27_bwa.sam

chos 7 

samtools view -Sb 13_27_bwa.sam > 13_27_bwa.bam

samtools view -q 10 -b 13_27_bwa.bam > 13_27_bwa_uniq.bam

samtools sort -@ 16 -m 4G 13_27_bwa_uniq.bam 13_27_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=13_27_bwa_uniq_sort.bam OUTPUT=dedup_13_27.bam METRICS_FILE=metrics.txt

samtools index dedup_13_27.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_13_27.bam -o 13_27.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 13_27.intervals -I dedup_13_27.bam -o re-aln_13_27.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_13_27.bam -stand_call_conf 30 -nct 128 -o 13_27.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 13_27.raw.vcf > filtered_13_27.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_13_27.bam -knownSites filtered_13_27.vcf -nct 128 -o recal_13_27.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_13_27.bam -BQSR recal_13_27.table -nct 128 -o recal_13_27.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_13_27.bam -stand_call_conf 30 -nct 128 -o 13_27.recal.vcf 


## gen 6 alns

bwa075a mem -t 100 -R '@RG\tID:16_40\tSM:gen_6\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_2/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_2/*R2_001.fastq.gz > 16_40_bwa.sam

chos 7 

samtools view -Sb 16_40_bwa.sam > 16_40_bwa.bam

samtools view -q 10 -b 16_40_bwa.bam > 16_40_bwa_uniq.bam

samtools sort -@ 16 -m 4G 16_40_bwa_uniq.bam 16_40_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=16_40_bwa_uniq_sort.bam OUTPUT=dedup_16_40.bam METRICS_FILE=metrics.txt

samtools index dedup_16_40.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_16_40.bam -o 16_40.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 16_40.intervals -I dedup_16_40.bam -o re-aln_16_40.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_16_40.bam -stand_call_conf 30 -nct 128 -o 16_40.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 16_40.raw.vcf > filtered_16_40.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_16_40.bam -knownSites filtered_16_40.vcf -nct 128 -o recal_16_40.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_16_40.bam -BQSR recal_16_40.table -nct 128 -o recal_16_40.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_16_40.bam -stand_call_conf 30 -nct 128 -o 16_40.recal.vcf 



bwa075a mem -t 100 -R '@RG\tID:17_31\tSM:gen_6\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_9/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_9/*R2_001.fastq.gz > 17_31_bwa.sam

chos 7 

samtools view -Sb 17_31_bwa.sam > 17_31_bwa.bam

samtools view -q 10 -b 17_31_bwa.bam > 17_31_bwa_uniq.bam

samtools sort -@ 16 -m 4G 17_31_bwa_uniq.bam 17_31_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=17_31_bwa_uniq_sort.bam OUTPUT=dedup_17_31.bam METRICS_FILE=metrics.txt

samtools index dedup_17_31.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_17_31.bam -o 17_31.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 17_31.intervals -I dedup_17_31.bam -o re-aln_17_31.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_17_31.bam -stand_call_conf 30 -nct 128 -o 17_31.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 17_31.raw.vcf > filtered_17_31.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_17_31.bam -knownSites filtered_17_31.vcf -nct 128 -o recal_17_31.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_17_31.bam -BQSR recal_17_31.table -nct 128 -o recal_17_31.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_17_31.bam -stand_call_conf 30 -nct 128 -o 17_31.recal.vcf 


bgzip -c 17_31.recal.vcf > 17_31.recal.vcf.gz
tabix -p vcf 17_31.recal.vcf.gz

bgzip -c 16_40.recal.vcf > 16_40.recal.vcf.gz
tabix -p vcf 16_40.recal.vcf.gz

bgzip -c 17_31.recal.vcf > 17_31.recal.vcf.gz
tabix -p vcf 17_31.recal.vcf.gz

vcf-isec -c -f 16_48.recal.vcf.gz 13_30_gatk/13_30.recal.vcf.gz 16_40_gatk/16_40.recal.vcf.gz 17_31_gatk/17_31.recal.vcf.gz | bgzip -c > out_v1_kept_snps.vcf.gz    ##   keeps snps found in both files



### map gen 7  

bwa075a mem -t 100 -R '@RG\tID:16_113\tSM:gen_7\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_6/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_6/*R2_001.fastq.gz > 16_113_bwa.sam

chos 7 

samtools view -Sb 16_113_bwa.sam > 16_113_bwa.bam

samtools view -q 10 -b 16_113_bwa.bam > 16_113_bwa_uniq.bam

samtools sort -@ 16 -m 4G 16_113_bwa_uniq.bam 16_113_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=16_113_bwa_uniq_sort.bam OUTPUT=dedup_16_113.bam METRICS_FILE=metrics.txt

samtools index dedup_16_113.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_16_113.bam -o 16_113.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 16_113.intervals -I dedup_16_113.bam -o re-aln_16_113.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_16_113.bam -stand_call_conf 30 -nct 128 -o 16_113.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 16_113.raw.vcf > filtered_16_113.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_16_113.bam -knownSites filtered_16_113.vcf -nct 128 -o recal_16_113.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_16_113.bam -BQSR recal_16_113.table -nct 128 -o recal_16_113.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_16_113.bam -stand_call_conf 30 -nct 128 -o 16_113.recal.vcf 



##  map gen 3

bwa075a mem -t 100 -R '@RG\tID:16_88\tSM:gen_3\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_4/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_4/*R2_001.fastq.gz > 16_88_bwa.sam

chos 7 

samtools view -Sb 16_88_bwa.sam > 16_88_bwa.bam

samtools view -q 10 -b 16_88_bwa.bam > 16_88_bwa_uniq.bam

samtools sort -@ 16 -m 4G 16_88_bwa_uniq.bam 16_88_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=16_88_bwa_uniq_sort.bam OUTPUT=dedup_16_88.bam METRICS_FILE=metrics.txt

samtools index dedup_16_88.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_16_88.bam -o 16_88.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 16_88.intervals -I dedup_16_88.bam -o re-aln_16_88.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_16_88.bam -stand_call_conf 30 -nct 128 -o 16_88.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 16_88.raw.vcf > filtered_16_88.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_16_88.bam -knownSites filtered_16_88.vcf -nct 128 -o recal_16_88.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_16_88.bam -BQSR recal_16_88.table -nct 128 -o recal_16_88.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_16_88.bam -stand_call_conf 30 -nct 128 -o 16_88.recal.vcf 



bwa075a mem -t 100 -R '@RG\tID:16_52\tSM:gen_3\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_3/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_3/*R2_001.fastq.gz > 16_52_bwa.sam

chos 7 

samtools view -Sb 16_52_bwa.sam > 16_52_bwa.bam

samtools view -q 10 -b 16_52_bwa.bam > 16_52_bwa_uniq.bam

samtools sort -@ 16 -m 4G 16_52_bwa_uniq.bam 16_52_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=16_52_bwa_uniq_sort.bam OUTPUT=dedup_16_52.bam METRICS_FILE=metrics.txt

samtools index dedup_16_52.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_16_52.bam -o 16_52.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 16_52.intervals -I dedup_16_52.bam -o re-aln_16_52.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_16_52.bam -stand_call_conf 30 -nct 128 -o 16_52.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 16_52.raw.vcf > filtered_16_52.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_16_52.bam -knownSites filtered_16_52.vcf -nct 128 -o recal_16_52.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_16_52.bam -BQSR recal_16_52.table -nct 128 -o recal_16_52.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_16_52.bam -stand_call_conf 30 -nct 128 -o 16_52.recal.vcf 


bgzip -c 16_113.recal.vcf > 16_113.recal.vcf.gz
tabix -p vcf 16_113.recal.vcf.gz

bgzip -c 16_88.recal.vcf > 16_88.recal.vcf.gz
tabix -p vcf 16_88.recal.vcf.gz

bgzip -c 16_52.recal.vcf > 16_52.recal.vcf.gz
tabix -p vcf 16_52.recal.vcf.gz

vcf-isec -c -f out_v1_kept_snps.vcf.gz 16_113_gatk/16_113.recal.vcf.gz 16_88_gatk/16_88.recal.vcf.gz 16_52_gatk/16_52.recal.vcf.gz | bgzip -c > out_v2_kept_snps.vcf.gz    
##   keeps snps found in both files





### pink clone map

bwa075a mem -t 100 -R '@RG\tID:16_98\tSM:gen_pink\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_5/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_5/*R2_001.fastq.gz > 16_98_bwa.sam

chos 7 

samtools view -Sb 16_98_bwa.sam > 16_98.bwa.bam

samtools view -q 10 -b 16_98.bwa.bam > 16_98_bwa_uniq.bam

samtools sort -@ 16 -m 4G 16_98_bwa_uniq.bam 16_98_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=16_98_bwa_uniq_sort.bam OUTPUT=dedup_16_98.bam METRICS_FILE=metrics.txt

samtools index dedup_16_98.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_16_98.bam -o 16_98.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 16_98.intervals -I dedup_16_98.bam -o re-aln_16_98.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_16_98.bam -stand_call_conf 30 -nct 128 -o 16_98.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 16_98.raw.vcf > filtered_16_98.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_16_98.bam -knownSites filtered_16_98.vcf -nct 128 -o recal_16_98.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_16_98.bam -BQSR recal_16_98.table -nct 128 -o recal_16_98.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_16_98.bam -stand_call_conf 30 -nct 128 -o 16_98.recal.vcf 

bgzip -c 16_98.recal.vcf > 16_98.recal.vcf.gz
tabix -p vcf 16_98.recal.vcf.gz


### gen 2 mapping

bwa075a mem -t 100 -R '@RG\tID:16_38\tSM:gen_2\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_1/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_1/*R2_001.fastq.gz > 16_38_bwa.sam

chos 7 

samtools view -Sb 16_38_bwa.sam > 16_38.bwa.bam

samtools view -q 10 -b 16_38.bwa.bam > 16_38_bwa_uniq.bam

samtools sort -@ 16 -m 4G 16_38_bwa_uniq.bam 16_38_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=16_38_bwa_uniq_sort.bam OUTPUT=dedup_16_38.bam METRICS_FILE=metrics.txt

samtools index dedup_16_38.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_16_38.bam -o 16_38.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 16_38.intervals -I dedup_16_38.bam -o re-aln_16_38.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_16_38.bam -stand_call_conf 30 -nct 128 -o 16_38.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 16_38.raw.vcf > filtered_16_38.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_16_38.bam -knownSites filtered_16_38.vcf -nct 128 -o recal_16_38.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_16_38.bam -BQSR recal_16_38.table -nct 128 -o recal_16_38.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_16_38.bam -stand_call_conf 30 -nct 128 -o 16_38.recal.vcf 

bgzip -c 16_38.recal.vcf > 16_38.recal.vcf.gz
tabix -p vcf 16_38.recal.vcf.gz



bwa075a mem -t 100 -R '@RG\tID:17_01\tSM:gen_2\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_7/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_7/*R2_001.fastq.gz > 17_01_bwa.sam

chos 7 

samtools view -Sb 17_01_bwa.sam > 17_01.bwa.bam

samtools view -q 10 -b 17_01.bwa.bam > 17_01_bwa_uniq.bam

samtools sort -@ 16 -m 4G 17_01_bwa_uniq.bam 17_01_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=17_01_bwa_uniq_sort.bam OUTPUT=dedup_17_01.bam METRICS_FILE=metrics.txt

samtools index dedup_17_01.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_17_01.bam -o 17_01.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 17_01.intervals -I dedup_17_01.bam -o re-aln_17_01.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_17_01.bam -stand_call_conf 30 -nct 128 -o 17_01.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 17_01.raw.vcf > filtered_17_01.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_17_01.bam -knownSites filtered_17_01.vcf -nct 128 -o recal_17_01.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_17_01.bam -BQSR recal_17_01.table -nct 128 -o recal_17_01.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_17_01.bam -stand_call_conf 30 -nct 128 -o 17_01.recal.vcf 

bgzip -c 17_01.recal.vcf > 17_01.recal.vcf.gz
tabix -p vcf 17_01.recal.vcf.gz


bwa075a mem -t 100 -R '@RG\tID:17_23\tSM:gen_2\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_8/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_8/*R2_001.fastq.gz > 17_23_bwa.sam

chos 7 

samtools view -Sb 17_23_bwa.sam > 17_23.bwa.bam

samtools view -q 10 -b 17_23.bwa.bam > 17_23_bwa_uniq.bam

samtools sort -@ 16 -m 4G 17_23_bwa_uniq.bam 17_23_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=17_23_bwa_uniq_sort.bam OUTPUT=dedup_17_23.bam METRICS_FILE=metrics.txt

samtools index dedup_17_23.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_17_23.bam -o 17_23.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 17_23.intervals -I dedup_17_23.bam -o re-aln_17_23.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_17_23.bam -stand_call_conf 30 -nct 128 -o 17_23.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 17_23.raw.vcf > filtered_17_23.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_17_23.bam -knownSites filtered_17_23.vcf -nct 128 -o recal_17_23.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_17_23.bam -BQSR recal_17_23.table -nct 128 -o recal_17_23.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_17_23.bam -stand_call_conf 30 -nct 128 -o 17_23.recal.vcf 

bgzip -c 17_23.recal.vcf > 17_23.recal.vcf.gz
tabix -p vcf 17_23.recal.vcf.gz


bwa075a mem -t 100 -R '@RG\tID:17_33\tSM:gen_2\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_10/*R1_001.fastq.gz /data/illum/171220_K00210_0093_BHNF75BBXX/Project_MWhitehead_15083_m1/Sample_10/*R2_001.fastq.gz > 17_33_bwa.sam

chos 7 

samtools view -Sb 17_33_bwa.sam > 17_33.bwa.bam

samtools view -q 10 -b 17_33.bwa.bam > 17_33_bwa_uniq.bam

samtools sort -@ 16 -m 4G 17_33_bwa_uniq.bam 17_33_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=17_33_bwa_uniq_sort.bam OUTPUT=dedup_17_33.bam METRICS_FILE=metrics.txt

samtools index dedup_17_33.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_17_33.bam -o 17_33.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 17_33.intervals -I dedup_17_33.bam -o re-aln_17_33.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_17_33.bam -stand_call_conf 30 -nct 128 -o 17_33.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 17_33.raw.vcf > filtered_17_33.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_17_33.bam -knownSites filtered_17_33.vcf -nct 128 -o recal_17_33.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_17_33.bam -BQSR recal_17_33.table -nct 128 -o recal_17_33.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_17_33.bam -stand_call_conf 30 -nct 128 -o 17_33.recal.vcf 

bgzip -c 17_33.recal.vcf > 17_33.recal.vcf.gz
tabix -p vcf 17_33.recal.vcf.gz

tabix -p vcf out_v2_kept_snps.vcf.gz

vcf-isec -c -f out_v2_kept_snps.vcf.gz 16_98_gatk/16_98.recal.vcf.gz 16_38_gatk/16_38.recal.vcf.gz 17_01_gatk/17_01.recal.vcf.gz 17_23_gatk/17_23.recal.vcf.gz 17_33_gatk/17_33.recal.vcf.gz | bgzip -c > out_v3_kept_snps.vcf.gz    
 
 

bwa075a mem -t 100 -R '@RG\tID:16_48\tSM:gen_2\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/171031_D00213_0226_AHYGM5BCXY/Project_MWhitehead_14766_m1/Sample_3-3_MW_aph/3-3_MW_aph_CGCTCATT-CCTATCCT_L002_R1_001.fastq.gz /data/illum/171031_D00213_0226_AHYGM5BCXY/Project_MWhitehead_14766_m1/Sample_3-3_MW_aph/3-3_MW_aph_CGCTCATT-CCTATCCT_L002_R2_001.fastq.gz > 16_48_bwa.sam

chos 7 

samtools view -Sb 16_48_bwa.sam > 16_48.bwa.bam

samtools view -q 10 -b 16_48.bwa.bam > 16_48_bwa_uniq.bam

samtools sort -@ 16 -m 4G 16_48_bwa_uniq.bam 16_48_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=16_48_bwa_uniq_sort.bam OUTPUT=dedup_16_48.bam METRICS_FILE=metrics.txt

samtools index dedup_16_48.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_16_48.bam -o 16_48.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 16_48.intervals -I dedup_16_48.bam -o re-aln_16_48.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_16_48.bam -stand_call_conf 30 -nct 128 -o 16_48.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 16_48.raw.vcf > filtered_16_48.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_16_48.bam -knownSites filtered_16_48.vcf -nct 128 -o recal_16_48.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_16_48.bam -BQSR recal_16_48.table -nct 128 -o recal_16_48.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_16_48.bam -stand_call_conf 30 -nct 128 -o 16_48.recal.vcf 

bgzip -c 16_48.recal.vcf > 16_48.recal.vcf.gz
tabix -p vcf 16_48.recal.vcf.gz


### map gen1

bwa075a mem -t 100 -R '@RG\tID:16_67\tSM:gen_1\tPL:illumina\tLB:lib1\tPU:unit1' ../ref_gen1.fa /data/illum/161208_K00210_0044_AHFYVTBBXX/Project_MWhitehead_11879_m1/Sample_1/1_TCCGGAGA-GCCTCTAT_L007_R1_001.fastq.gz /data/illum/161208_K00210_0044_AHFYVTBBXX/Project_MWhitehead_11879_m1/Sample_1/1_TCCGGAGA-GCCTCTAT_L007_R2_001.fastq.gz > 16_67_bwa.sam

chos 7 

samtools view -Sb 16_67_bwa.sam > 16_67.bwa.bam

samtools view -q 10 -b 16_67.bwa.bam > 16_67_bwa_uniq.bam

samtools sort -@ 16 -m 4G 16_67_bwa_uniq.bam 16_67_bwa_uniq_sort
    
java -Xmx200g -jar /pub28/markw/bin/picard/picard-2.8.2.jar MarkDuplicates INPUT=16_67_bwa_uniq_sort.bam OUTPUT=dedup_16_67.bam METRICS_FILE=metrics.txt

samtools index dedup_16_67.bam

java -Xmx200g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T RealignerTargetCreator -R ../ref_gen1.fa -I dedup_16_67.bam -o 16_67.intervals

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T IndelRealigner -R ../ref_gen1.fa -targetIntervals 16_67.intervals -I dedup_16_67.bam -o re-aln_16_67.bam
    
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I re-aln_16_67.bam -stand_call_conf 30 -nct 128 -o 16_67.raw.vcf 

vcffilter -f "DP > 10 & QD > 20" 16_67.raw.vcf > filtered_16_67.vcf

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T BaseRecalibrator -R ../ref_gen1.fa -I re-aln_16_67.bam -knownSites filtered_16_67.vcf -nct 128 -o recal_16_67.table

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T PrintReads -R ../ref_gen1.fa -I re-aln_16_67.bam -BQSR recal_16_67.table -nct 128 -o recal_16_67.bam 

java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T HaplotypeCaller -R ../ref_gen1.fa -I recal_16_67.bam -stand_call_conf 30 -nct 128 -o 16_67.recal.vcf 

bgzip -c 16_67.recal.vcf > 16_67.recal.vcf.gz
tabix -p vcf 16_67.recal.vcf.gz




samtools mpileup -B -f Cdiff078.fa 

sample1/sample1.realigned.bam sample2/sample2.realigned.bam sample3/sample3.realigned.bam | java -jar VarScan.v2.3.7.jar mpileup2cns --min-coverage 2 --min-var-freq 0.8 --p-value 0.005 --variants --output-vcf > variants.vcf


## need to sort out read group names for each bam! :(

java -jar ~/bin/picard/picard.jar AddOrReplaceReadGroups \
      I=input.bam \
      O=output.bam \
      RGID=4 \
      RGLB=lib1 \
      RGPL=illumina \
      RGPU=unit1 \
      RGSM=20

bam=$(ls *_gatk/recal_*.bam)
echo $bam
samtools mpileup -B -f ref_gen1.fa $bam | java -jar ~/bin/VarScan/VarScan.v2.3.9.jar mpileup2cns --min-coverage 2 --min-var-freq 0.8 --p-value 0.005 --variants --output-vcf > variants.vcf


 
 
vcf-isec -n +2 -f out_v3_kept_snps.vcf.gz 13_27_gatk/13_27.recal.vcf.gz | bgzip -c > match.vcf.gz 
 
## oops! have been using the wrong tool to filter the vcfs :/

#  need:

vcf-isec -n +5 -f 13_30_gatk/13_30.recal.vcf.gz 16_113_gatk/16_113.recal.vcf.gz 16_38_gatk/16_38.recal.vcf.gz \
	16_40_gatk/16_40.recal.vcf.gz 16_48.recal.vcf.gz 16_52_gatk/16_52.recal.vcf.gz 16_88_gatk/16_88.recal.vcf.gz \
	16_98_gatk/16_98.recal.vcf.gz 17_01_gatk/17_01.recal.vcf.gz 17_23_gatk/17_23.recal.vcf.gz 17_31_gatk/17_31.recal.vcf.gz \
	17_33_gatk/17_33.recal.vcf.gz | bgzip -c > full_out.vcf.gz

vcf-isec -n +12 -f 13_30_gatk/13_30.recal.vcf.gz 16_113_gatk/16_113.recal.vcf.gz 16_38_gatk/16_38.recal.vcf.gz \
	16_40_gatk/16_40.recal.vcf.gz 16_48.recal.vcf.gz 16_52_gatk/16_52.recal.vcf.gz 16_88_gatk/16_88.recal.vcf.gz \
	16_98_gatk/16_98.recal.vcf.gz 17_01_gatk/17_01.recal.vcf.gz 17_23_gatk/17_23.recal.vcf.gz 17_31_gatk/17_31.recal.vcf.gz \
	17_33_gatk/17_33.recal.vcf.gz | bgzip -c > full2_out.vcf.gz




 
java -Xmx400g -jar /pub28/markw/bin/gatk/GenomeAnalysisTK.jar -R ref_gen1.fa -T SelectVariants --variant out_v3_kept_snps.vcf -o snps_on_v3.vcf --selectTypeToExclude INDEL 


vcf2bed.py --snvs < out_v3_kept_snps.vcf > v3_snvs.bed

#   http://userweb.eng.gla.ac.uk/cosmika.goswami/snp_calling/SNPCalling.html

cat ref_gen1.fa | awk '$0 ~ ">" {print c; c=0;printf substr($0,2,100) "\t"; } $0 !~ ">" {c+=length($0);} END { print c; }' > ref_gen1_fasta_lengths.txt




vcf2bed.py --snvs < snps_on_v3.vcf > all_snps.bed 

awk -F\\t '{print>$1}' ../all_snps.bed   # generates bed files for each contig

## then run following R script - extractbins.R - indir of bed files  - "   R CMD BATCH ../snp_beds/extractbins.R    "

### - notes here, need to set current working directory where to beds are, also change bin size with 'binwidth'
 
setwd("/pub28/markw/M_euph/MW16_48/gatk/snp_beds")

library(ggplot2)

extractbins<-function(x){
  
  fnm<-paste('Contig_',x,sep='')
  
  if(file.exists(fnm)==T){
    
    snps<-read.table(fnm,sep="\t",header=F)
    colnames(snps)<- c("chr","start","end","id")
    
    snp_plot<-qplot(snps$start,
                    geom="histogram",
                    binwidth = 500,  
                    main = "snps bin - 500bp", 
                    xlab = "length",  
                    fill=I("blue"), 
                    col=I("red"), 
                    alpha=I(.2))
    
    plot_points<-ggplot_build(snp_plot)
    data_points<-plot_points$data[[1]]
    
    return(data_points)
    
  }
  
}

for(i in 1:10){
  
  thisdata<-extractbins(i)
  newfnm<-paste('snpsbin_',i,sep='')
  write.table(thisdata,file=newfnm,sep='\t')
  
}

######

for file in snpsbin_* ; do
	name=$file
	awk '($2 >= 20)' $file > "$name"filt
done
							##### to get any snp count in a 500 bp region that is 20 snps or more
mkdir filt_counts

cd filt_counts

mv ../*filt .

find . -type f -empty -delete    #  removes any empty files in this directory (and below!!)

for file in snpsbin_ ; do
	awk '{print $0, FILENAME}' $file > "$file"_mod
done 													####  adds contig name to end of each row

rm *filt

### 

bin number is far left coulmn, followed by snp copunt in that bin. final column denotes what contig.
to find where the bin lies on the genome, we multiply bin number by 500 (size of bin), then add bp length to first snp
e.g. contig 10, bin 16 = 42 snps, i.e. 16 x 500 = 8000, + 4871 = 12871

Contig_10	11871	13871

bedtools getfasta -fi ref_gen1.fa -bed contig_10_snps_bin.bed -fo c10_region.fa

###

sed -e 's/snpsbin_/_Contig_/g' all.txt | sed -e 's/filt/_/g'  > all_mod.txt

sort -k 19,19 all_mod.txt

head -n1 -q /pub28/markw/M_euph/MW16_48/gatk/snp_beds/Contig_* > first_snp.list

paste <(awk '{print $1"_"}' first_snp.list) <(awk '{print $2}' first_snp.list) | sed -e 's/^/_/g'  > first_snp_mod.list 

## if column 19 in all_mod.txt = column 1 in first_snp_mod.list, 

awk '{print $19}' all_mod.txt  | grep -f - first_snp_mod.list > out

paste <(awk '{print $0}' out) <(sed -e 's/\t/:/g' all_mod_sort.txt | cut -d':' -f1) | head -n 40 | sed -e 's/"//g' | sed -e 's/$/\t500/g' > out2


awk '{ print $0,"\t"$3 * $4 }' out2 | awk '{ print $0,"\t"$5 + $2}' | awk '{ print $0,"\t"$6 - 1000 }' | awk '{ print $0,"\t"$6 + 1000 }' > out3

awk '{print $1,"\t"$7"\t"$8}' out3 | sed -e 's/-.*\t/0\t/g' | sed -e 's/^_//g' | sed -e 's/_//g' | sed -e 's/Contig/Contig_/g' | sed -e 's/ //g' > interesting.bed

bedtools getfasta -fi ../../ref_gen1.fa -bed interesting.bed -fo interesting.fa



###



Contig_1	6840000	6845000

bedtools getfasta -fi ../ref_gen1.fa -bed c1.bed -fo c1_region.fa


head -n +17139 ../snps_on_v3.vcf | tail -n +10714 > 10-20ctgs_snps.vcf

for i in $(grep -v "#" 10-20ctgs_snps.vcf | cut -f1|sort|uniq); do grep -i -e "$i" -e "#CHROM" 10-20ctgs_snps.vcf > $i.vcf;done




vcf-merge 09_03_gatk/09_03.recal.vcf.gz 16_113_gatk/16_113.recal.vcf.gz 16_88_gatk/16_88.recal.vcf.gz 17_31_gatk/17_31.recal.vcf.gz 13_27_gatk/13_27.recal.vcf.gz  16_38_gatk/16_38.recal.vcf.gz 16_98_gatk/16_98.recal.vcf.gz 17_33_gatk/17_33.recal.vcf.gz 13_30_gatk/13_30.recal.vcf.gz 16_40_gatk/16_40.recal.vcf.gz 17_01_gatk/17_01.recal.vcf.gz 15_10_gatk/15_10.recal.vcf.gz 16_52_gatk/16_52.recal.vcf.gz 17_23_gatk/17_23.recal.vcf.gz | bgzip -c > merged.vcf.gz 

Using column name 'gen_1' for 09_03_gatk/09_03.recal.vcf.gz:gen_1
Using column name 'gen_7' for 16_113_gatk/16_113.recal.vcf.gz:gen_7
Using column name 'gen_3' for 16_88_gatk/16_88.recal.vcf.gz:gen_3
Using column name 'gen_6' for 17_31_gatk/17_31.recal.vcf.gz:gen_6
Using column name '13_27' for 13_27_gatk/13_27.recal.vcf.gz:13_27
Using column name 'gen_2' for 16_38_gatk/16_38.recal.vcf.gz:gen_2
Using column name 'gen_pink' for 16_98_gatk/16_98.recal.vcf.gz:gen_pink
Using column name '17_33_gatk/17_33.recal_gen_2' for 17_33_gatk/17_33.recal.vcf.gz:gen_2
Using column name '13_30' for 13_30_gatk/13_30.recal.vcf.gz:13_30
Using column name '16_40_gatk/16_40.recal_gen_6' for 16_40_gatk/16_40.recal.vcf.gz:gen_6
Using column name '17_01_gatk/17_01.recal_gen_2' for 17_01_gatk/17_01.recal.vcf.gz:gen_2
Using column name '15_10_gatk/15_10.recal_gen_1' for 15_10_gatk/15_10.recal.vcf.gz:gen_1
Using column name '16_52_gatk/16_52.recal_gen_3' for 16_52_gatk/16_52.recal.vcf.gz:gen_3
Using column name '17_23_gatk/17_23.recal_gen_2' for 17_23_gatk/17_23.recal.vcf.gz:gen_2


for file in *recal.vcf ; do
	name=${file%.recal.vcf}
	java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant $file -o "$name"_QD30.vcf -select "QD > 30.0"
done
	
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 09_03.recal.vcf -o 09_03_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 16_113.recal.vcf -o 16_113_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 16_88.recal.vcf -o 16_88_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 17_31.recal.vcf -o 17_31_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 13_27.recal.vcf -o 13_27_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 16_38.recal.vcf -o 16_38_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 16_98.recal.vcf -o 16_98_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 17_33.recal.vcf -o 17_33_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 13_30.recal.vcf -o 13_30_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 16_40.recal.vcf -o 16_40_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 17_01.recal.vcf -o 17_01_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 15_10.recal.vcf -o 15_10_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 17_23.recal.vcf -o 17_23_QD30.vcf -select "QD > 30.0"
java -Xmx400g -jar ~/bin/gatk/GenomeAnalysisTK.jar -T SelectVariants -R ../ref_gen1.fa --variant 16_52.recal.vcf -o 16_52_QD30.vcf -select "QD > 30.0"

	
java -Xmx8g -jar ~/bin/gatk/GenomeAnalysisTK.jar -R ../ref_gen1.fa -T VariantsToTable -V 09_03_QD30.vcf -F CHROM -F POS -F ID -F QUAL -F REF -F ALT -F QUAL -F FILTER -F INFO -F FORMAT -o 09_03_QD30.txt -AMD -GF GT 
java -Xmx8g -jar ~/bin/gatk/GenomeAnalysisTK.jar -R ../ref_gen1.fa -T VariantsToTable -V 13_27_QD30.vcf -F CHROM -F POS -F ID -F QUAL -F REF -F ALT -F QUAL -F FILTER -F INFO -F FORMAT -o 13_27_QD30.txt -AMD -GF GT 
java -Xmx8g -jar ~/bin/gatk/GenomeAnalysisTK.jar -R ../ref_gen1.fa -T VariantsToTable -V 13_30_QD30.vcf -F CHROM -F POS -F ID -F QUAL -F REF -F ALT -F QUAL -F FILTER -F INFO -F FORMAT -o 13_30_QD30.txt -AMD -GF GT 
java -Xmx8g -jar ~/bin/gatk/GenomeAnalysisTK.jar -R ../ref_gen1.fa -T VariantsToTable -V 16_38_QD30.vcf -F CHROM -F POS -F ID -F QUAL -F REF -F ALT -F QUAL -F FILTER -F INFO -F FORMAT -o 16_38_QD30.txt -AMD -GF GT 
java -Xmx8g -jar ~/bin/gatk/GenomeAnalysisTK.jar -R ../ref_gen1.fa -T VariantsToTable -V 16_113_QD30.vcf -F CHROM -F POS -F ID -F QUAL -F REF -F ALT -F QUAL -F FILTER -F INFO -F FORMAT -o 16_113_QD30.txt -AMD -GF GT 


Rscript --vanilla vcftohapmap.R 09_03_QD30.txt 09_03_QD30.hap.txt
Rscript --vanilla vcftohapmap.R 13_30_QD30.txt 13_30_QD30.hap.txt
Rscript --vanilla vcftohapmap.R 13_27_QD30.txt 13_27_QD30.hap.txt
Rscript --vanilla vcftohapmap.R 16_113_QD30.txt 16_113_QD30.hap.txt
Rscript --vanilla vcftohapmap.R 16_38_QD30.txt 16_38_QD30.hap.txt





vcf-merge 09_03_sort.vcf.gz 13_27_sort.vcf.gz 13_30_sort.vcf.gz 16_38_sort.vcf.gz 16_113_sort.vcf.gz | bgzip -c merged_test.vcf.gz
[bgzip] No such file or directory: merged_test.vcf.gz
Using column name 'gen_1' for 09_03_sort.vcf.gz:gen_1
Using column name '13_27' for 13_27_sort.vcf.gz:13_27
Using column name '13_30' for 13_30_sort.vcf.gz:13_30
Using column name 'gen_2' for 16_38_sort.vcf.gz:gen_2
Using column name 'gen_7' for 16_113_sort.vcf.gz:gen_7

vcf-merge 09_03_QD30.vcf.gz 13_27_QD30.vcf.gz 13_30_QD30.vcf.gz 16_38_QD30.vcf.gz 16_113_QD30.vcf.gz > merged2_test.vcf  | bgzip -c merged2_test.vcf.gz

java -Xmx8g -jar ~/bin/gatk/GenomeAnalysisTK.jar -R ../ref_gen1.fa -T VariantsToTable -V 16_52_QD30.vcf -F CHROM -F POS -F ID -F QUAL -F REF -F ALT -F QUAL -F FILTER -F INFO -F FORMAT -o 16_52_QD30.txt -AMD -GF GT 